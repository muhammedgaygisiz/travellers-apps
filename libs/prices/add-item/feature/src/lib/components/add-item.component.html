<!-- Pattern to force cd combined with reactive form groups -->
<ng-container *ngIf="priceFormGroup.statusChanges | async"></ng-container>

<ta-page
  [enableBackButton]="true"
  [isAuthenticated]="false"
  [hideAuthButton]="true"
>
  <ta-card>
    <div class="ion-padding">
      <form [formGroup]="priceFormGroup">
        <ion-item lines="full">
          <ion-label position="floating">Product Name</ion-label>
          <ion-input type="text" formControlName="productName"></ion-input>
        </ion-item>

        <ion-item lines="full">
          <ion-label position="floating">Price</ion-label>
          <ion-input
            type="number"
            formControlName="price"
            value=""
            inputmode="decimal"
          ></ion-input>
        </ion-item>

        <ion-item lines="full">
          <ion-label position="floating">Location</ion-label>
          <ion-input
            type="text"
            formControlName="location"
            [value]="location"
          ></ion-input>
        </ion-item>

        <ion-item lines="full">
          <ion-label position="floating">Image Source</ion-label>
          <ion-input type="text" formControlName="src"></ion-input>
        </ion-item>

        <ion-button
          class="ion-margin-top"
          expand="block"
          [disabled]="!priceFormGroup.valid"
          (click)="save.emit(priceFormGroup.value)"
          >Save
        </ion-button>

        <div class="ion-margin-top">
          <div>
            <ion-text
              class="ion-padding"
              color="danger"
              *ngIf="
                !priceFormGroup.controls['productName'].pristine &&
                !priceFormGroup.controls['productName'].valid
              "
            >
              Product Name is required.
            </ion-text>
          </div>
          <div>
            <ion-text
              class="ion-padding"
              color="danger"
              *ngIf="
                !priceFormGroup.controls['price'].pristine &&
                !priceFormGroup.controls['price'].valid
              "
            >
              Price is required and must be a decimal.
            </ion-text>
          </div>
          <div>
            <ion-text
              class="ion-padding"
              color="danger"
              *ngIf="
                !priceFormGroup.controls['location'].pristine &&
                !priceFormGroup.controls['location'].valid
              "
            >
              Location is required.
            </ion-text>
          </div>
          <div>
            <ion-text
              class="ion-padding"
              color="danger"
              *ngIf="
                priceFormGroup.controls['src'].errors?.['errorOnLoad']
                && !(priceFormGroup.controls['src'].status !== 'PENDING')
              "
            >
              Could not load image from '{{
                priceFormGroup.controls['src'].value
              }}'
            </ion-text>
          </div>
        </div>
      </form>
    </div>
  </ta-card>
  <ta-card>
    <div
      class="ion-margin"
      *ngIf="
        priceFormGroup.controls['src'].status === 'PENDING' ||
        priceFormGroup.controls['src'].status === 'VALID'
      "
    >
      <img loading="lazy" [src]="priceFormGroup.controls['src'].value" />
    </div>
  </ta-card>
</ta-page>
